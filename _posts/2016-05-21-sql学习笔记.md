---
title: "sql学习笔记"
layout: post
date: 2016-05-21 22:48
image: /assets/images/markdown.jpg
headerImage: false
tag:
- 学习笔记
- sql注入
blog: true
author: kullua
description: 初学sql


---

​       SQL 注入攻击（SQL Injection），简称注入攻击，是 Web 开发中最常见的一种安全漏洞。

​       可以用它来从数据库获取敏感信息，或者利用数据库的特性执行添加用户，导出文件等一系列恶意操作，甚至有可能获取数据库乃至系统用户最高权限。

​       SQL 注入的主要形式包括直接将代码插入到与 SQL 命令串联在一起并使其得以执行的用户输入变量。一种间接的攻击会将恶意代码注入要在表中存储或作为元数据存储的字符串。在存储的字符串随后串连到一个动态 SQL 命令中时，将执行该恶意代码。

​        注入过程的工作方式是提前终止文本字符串，然后追加一个新的命令。由于插入的命令可能在执行前追加其他字符串，因此攻击者将用注释标记“--”来终止注入的字符串。执行时，此后的文本将被忽略。

​      SQL 注入攻击的危害这么大，那么该如何来防治呢?下面这些建议或许对防治 SQL 注入

有一定的帮助。

1. 严格限制 Web 应用的数据库的操作权限，给此用户提供仅仅能够满足其工作的最低权限，从而最大限度的减少注入攻击对数据库的危害。不要使用超级用户或所有者帐号去连接数据库，要用权限被严格限制的帐号。也可以选择使用数据库的存储过程和预定义指针等特性来抽象数库访问，使用户不能直接访问数据表和视图。但这个办法又有别的影响。

2. 检查输入的数据是否具有所期望的数据格式，严格限制变量的类型，例如使用

regexp 包进行一些匹配处理，或者使用 strconv 包对字符串转化成其他基本类型

的数据进行判断。

3. 对进入数据库的特殊字符（'"\尖括号&*;等）进行转义处理，或编码转换。Go 的 text/template 包里面的 HTMLEscapeString 函数可以对字符串进行转义处理。使用数据库特定的敏感字符转义函数（比如 mysql_escape_string() 和sql_escape_string()）把用户提交上来的非数字数据进行转义。如果数据库没有

专门的敏感字符转义功能的话 addslashes() 和 str_replace() 可以代替完成这个工作。

4. 所有的查询语句建议使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中，即不要直接拼接 SQL 语句。例如使用

   database/sql 里面的查询函数 Prepare 和 Query，或者 Exec(querystring,

args ...interface{})。

5. 在应用发布之前建议使用专业的 SQL 注入检测工具进行检测，以及时修补被发现的 SQL 注入漏洞。网上有很多这方面的开源工具，例如 SQLChop、sqlmap、SQLninja

等。避免网站打印出 SQL 错误信息，比如类型错误、字段不匹配等，把代码里的 SQL

语句暴露出来，以防止攻击者利用这些错误信息进行 SQL 注入。

6. 如果程序等待输入一个数字，可以考虑使用 is_numeric() 来检查，或者直接使用

settype() 来转换它的类型，也可以用 sprintf() 把它格式化为数字。